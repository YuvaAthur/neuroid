// $Id$
/**
 * For running the network a number of times (say 100) to get
 * statistically significant performance results.
 */

setAccessibility(true);

source("preamble.bsh");
source("stats.bsh");

correctProfile = new Profile();
spuriousProfile = new Profile();

maxTrials = 10;
numberOfMedialAreas = 2;
numberOfObjects = 5;
startTime = System.currentTimeMillis();

for (timeConstantM = 7; timeConstantM < (numberOfMedialAreas + 1) * 2 * 7; timeConstantM += 7) {

    meanQc = 0; minQc = Double.MAX_VALUE; maxQc = Double.MIN_VALUE;
    meanQs = 0; minQs = Double.MAX_VALUE; maxQs = Double.MIN_VALUE;

    for (numberOfTrials = 0; numberOfTrials < maxTrials; numberOfTrials++) {
	runOnce(numberOfObjects, numberOfMedialAreas, timeConstantM, Double.NaN);
	meanQc += qc;
	meanQs += qs;
	minQc = Math.min(minQc, qc);
	minQs = Math.min(minQs, qs);
	maxQc = Math.max(maxQc, qc);
	maxQs = Math.max(maxQs, qs);
    }
    meanQc /= maxTrials;
    meanQs /= maxTrials;

    correctProfile.put(new Double(timeConstantM), new ErrorValue(meanQc, minQc, maxQc));
    spuriousProfile.put(new Double(timeConstantM), new ErrorValue(meanQs, minQs, maxQs));

     
} // end of for (numberOfObjects = 1; numberOfObjects < 5; numberOfObjects++)

print("correct concept qualities = " + correctProfile);
print("spurious concept quality = " + spuriousProfile);

if (grapher == null || grapher == void)
    matlab();

correctData = new Grapher.ErrorData(grapher, "Correct concepts", correctProfile);
spuriousData = new Grapher.ErrorData(grapher, "Spurious concepts", spuriousProfile);

Grapher.Data[] datas = {correctData, spuriousData};

p = new SuperposedDataPlot(null, datas);
p.setTitle("Performance with " + numberOfMedialAreas + " Layers over " +
	   maxTrials + " Trials, " + numberOfObjects + " Objects");
p.setXLabel("Membrane Time Constant \\tau_m");
p.setYLabel("Quality");

h = grapher.display(p, null);

print("Elapsed experiment time: " + (System.currentTimeMillis() - startTime) + " msec");
